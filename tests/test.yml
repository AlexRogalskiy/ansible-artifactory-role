---

- hosts: test_host
  become: yes

  pre_tasks:
    - name: "Prepare apt cache"
      apt:
        autoremove: yes
        autoclean: yes
        update_cache: yes
        cache_valid_time: 86400
      ignore_errors: yes

  roles:
    - role: geerlingguy.postgresql # Testing this role against not only default Derby database but Postgres too.
      become_method: su
      postgresql_databases:
        - name: artifactorydb
          owner: artifactory
      postgres_users_no_log: false
      postgresql_users:
        - name: artifactory
          password: P@ssw0rd
      postgresql_locales:
        - 'en_US.UTF-8'
        - 'ru_RU.UTF-8'
    
    - role: eugene_krivosheyev.artifactory
      artifactory_port: 8081
      artifactory_ui_port: 8082
      artifactory_username: admin
      artifactory_password: P@ssw0rd
      artifactory_database_type: 'postgresql'
      artifactory_database: 'localhost:5432/artifactorydb'
      artifactory_database_user: artifactory
      artifactory_database_password: P@ssw0rd
